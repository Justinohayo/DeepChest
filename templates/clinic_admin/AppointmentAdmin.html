<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>All Appointments - DeepChest</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="stylesheet" href="/static/admin.css"/>
    <link rel="stylesheet" href="/static/logostyle.css" />
  </head>
  <body>
    <nav>
      <div class="logo">
        <a href="/admin_home">
          <img src="{{ url_for('static', filename='logo_DeepChest.png') }}" class="logo-img" />
        </a>
        <div class="logo-text">DeepChest</div>
      </div>
      <div class="nav-links">
        <a href="/admin_home">Home</a>
        <a href="/admin/appointments">Appointments</a>
        <a href="/admin/ManageAccount">Manage Accounts</a>
       <a href="/admin/manage_reports">Manage Reports</a>
       <div class="dropdown">
          <button class="dropbtn">Account &#9662;</button>
          <div class="dropdown-content">
            <a href="/admin/manage_clinic">Manage Clinic</a>
            <a href="/logout">Logout</a>
          </div>
        </div>
      </div>
    </nav>
    {# Show Flask flash messages #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="admin-content">
      <h1>Clinic Appointments</h1>
      <div class="appointments-flex">
        <!-- Appointments List (Left) -->
        <div class="appointments-list-panel">
          <h3>All Scheduled Appointments</h3>
          <form id="edit-appt-form" method="POST" action="/admin/edit-appointments">
            <ul class="appointments-list">
              {% if appointments %}
                {% for appt in appointments %}
                  <li>
                    <input type="radio" name="appointment_id" value="{{ appt.apptID }}" id="appt{{ appt.apptID }}" required>
                    <label for="appt{{ appt.apptID }}">
                      <strong>{{ appt.appointment_date }}</strong> {{ appt.appointment_time }}<br />
                      Patient: {{ appt.firstName }} {{ appt.lastName }}<br />
                      Doctor: {{ appt.doctorFirstName or 'Not Assigned' }} {{ appt.doctorLastName or '' }}<br />
                      Symptoms: <span class="appt-notes">{{ appt.symptoms or 'None provided' }}</span>
                    </label>
                  </li>
                {% endfor %}
              {% else %}
                <li>No appointments scheduled.</li>
              {% endif %}
            </ul>
          </form>
        </div>
        <!-- Actions (Right) -->
        <div class="appointments-actions-panel">
          <button class="appt-action-btn" onclick="document.getElementById('edit-appt-form').submit();">
            Edit Appointment
          </button>
          <button class="appt-action-btn" onclick="window.location.href='/admin/book-appointment'">
            Book New Appointment
          </button>
          <form id="delete-appt-form" method="POST" action="/admin/delete-appointment" style="margin: 0;">
            <input type="hidden" name="appointment_id" id="delete-appointment-id" />
            <button type="submit" class="appt-action-btn" style="background:#c82333;" onclick="return confirm('Are you sure you want to delete this appointment? This action cannot be undone.');">
              Delete Appointment
            </button>
          </form>
        </div>
      </div>
    </div>
    <script>
      // Sync selected appointment to delete form
      document.querySelectorAll('input[name="appointment_id"]').forEach(radio => {
        radio.addEventListener('change', function() {
          document.getElementById('delete-appointment-id').value = this.value;
        });
      });
    </script>
  </body>
</html>
