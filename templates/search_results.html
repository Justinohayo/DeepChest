<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search Results - DeepChest</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <!-- Dynamic Navbar -->
    {% if user_type == 'patient' %}
      <nav>
        <div class="logo">DeepChest</div>
        <div class="nav-links">
          <a href="/patient_home">Home</a>
          <a href="/patient/appointments">Appointments</a>
          <a href="/patient/reports">My Reports</a>
          <a href="/patient/messages">Message</a>
          <a href="/patient/notifications">Notifications</a>
          <div class="dropdown">
            <button class="dropbtn">Account &#9662;</button>
            <div class="dropdown-content">
              <a href="/patient/account">Manage Account</a>
              <a href="/logout">Logout</a>
            </div>
          </div>
        </div>
      </nav>
    {% elif user_type == 'doctor' %}
      <nav>
        <div class="logo">DeepChest</div>
        <div class="nav-links">
          <a href="/doctor_home">Home</a>
          <a href="/doctor/appointments">Appointments</a>
          <a href="/doctor/patients">My Patients</a>
          <a href="/doctor/reports">Reports</a>
          <a href="/doctor/ai_diagnosis">AI Diagnosis</a>
          <div class="dropdown">
            <button class="dropbtn">Account &#9662;</button>
            <div class="dropdown-content">
              <a href="/doctor/account">Manage Account</a>
              <a href="/logout">Logout</a>
            </div>
          </div>
        </div>
      </nav>
    {% elif user_type == 'clinicadmin' %}
      <nav>
        <div class="logo">DeepChest</div>
        <div class="nav-links">
          <a href="/admin_home">Home</a>
          <a href="/logout">Logout</a>
        </div>
      </nav>
    {% else %}
      <nav>
        <div class="logo">DeepChest</div>
        <div class="nav-links">
          <a href="/login">Login</a>
          <a href="/signup">Sign Up</a>
        </div>
      </nav>
    {% endif %}

    <!-- Search Results Section -->
    <div class="search-results-container">
      <h1>Search Results for "{{ query }}"</h1>

      <div class="results-search-bar-container">
        <form method="GET" action="/search">
          <input
            type="text"
            name="query"
            class="search-bar"
            placeholder="Search for other appointments, or reports..."
            autocomplete="off"
          />
          <button type="submit" class="search-btn">Search</button>
        </form>
      </div>

      {% if results.appointments %}
        <h2>Appointments</h2>
        <table class="search-table">
          <thead>
            <tr>
              <th>Patient Name</th>
              <th>Date</th>
              <th>Time</th>
              <th>Symptoms</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            {% for a in results.appointments %}
            <tr>
              <td>
                {% if a.firstName and a.lastName %}
                  {{ a.firstName }} {{ a.lastName }}
                {% elif a.patientName %}
                  {{ a.patientName }}
                {% else %}
                  Patient ID: {{ a.patientID }}
                {% endif %}
              </td>
              <td>{{ a.appointment_date }}</td>
              <td>{{ a.appointment_time }}</td>
              <td>{{ a.symptoms }}</td>
              <td>
                <a
                  href="{% if user_type == 'patient' %}{{ url_for('p_appointments_search', apptID=a.apptID) }}
                        {% elif user_type == 'doctor' %}{{ url_for('doctor_appointments_search', apptID=a.apptID) }}
                        {% elif user_type == 'clinicadmin' %}{{ url_for('admin_appointments_search', apptID=a.apptID) }}
                        {% else %}#{% endif %}"
                >View</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      {% if results.reports %}
        <h2>Reports</h2>
        <table class="search-table">
          <thead>
            <tr>
              <th>Report ID</th>
              <th>Patient Name</th>
              <th>Doctor Name</th>
              <th>Date</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            {% for r in results.reports %}
            <tr>
              <td>{{ r.reportID }}</td>
              <td>
                {% if r.patientFirstName and r.patientLastName %}
                  {{ r.patientFirstName }} {{ r.patientLastName }}
                {% else %}
                  Patient ID: {{ r.patientID }}
                {% endif %}
              </td>
              <td>
                {% if r.doctorFirstName and r.doctorLastName %}
                  {{ r.doctorFirstName }} {{ r.doctorLastName }}
                {% else %}
                  Doctor ID: {{ r.doctorID }}
                {% endif %}
              </td>
              <td>{{ r.reportDate }}</td>
              <td>
                <a
                  href="{% if user_type == 'patient' %}{{ url_for('patient_reports_search', reportID=r.reportID) }}
                        {% elif user_type == 'doctor' %}{{ url_for('doctor_reports_search', reportID=r.reportID) }}
                        {% elif user_type == 'clinicadmin' %}{{ url_for('admin_reports_search', reportID=r.reportID) }}
                        {% else %}#{% endif %}"
                >View</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      {% if results.patients %}
        <h2>Patients</h2>
        <table class="search-table">
          <thead>
            <tr>
              <th>Patient ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Date of Birth</th>
            </tr>
          </thead>
          <tbody>
            {% for p in results.patients %}
            <tr>
              <td>{{ p.USERID }}</td>
              <td>{{ p.firstName }} {{ p.lastName }}</td>
              <td>{{ p.email }}</td>
              <td>{{ p.phone }}</td>
              <td>{{ p.dateofbirth }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      {% if not results.appointments and not results.reports and not results.patients %}
        <p>No results found.</p>
      {% endif %}
    </div>
  </body>
</html>
